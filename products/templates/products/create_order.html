{% load i18n static %}
<!DOCTYPE html>
<html lang="{% get_current_language as LANGUAGE_CODE %}{{ LANGUAGE_CODE }}" dir="{% if LANGUAGE_CODE == 'ar' %}rtl{% else %}ltr{% endif %}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>{% trans "Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨" %}</title>
    <link rel="icon" type="image/jpeg" href="https://i.postimg.cc/FzSYsKp6/logo-1.jpg">
    <link rel="stylesheet" href="{% static 'css/product_list.css' %}?v={% now 'U' %}">
    <style>
        .form-group {
            margin: 15px 0;
        }
        .form-control {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 100%;
        }
        .btn-primary {
            padding: 10px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .btn-primary:hover {
            background: #2980b9;
        }
        .cart-summary {
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .cart-summary h3 {
            margin-top: 0;
        }
        .cart-summary table {
            width: 100%;
            border-collapse: collapse;
        }
        .cart-summary th, .cart-summary td {
            padding: 10px;
            text-align: right;
            border-bottom: 1px solid #ddd;
        }
        .total-price {
            font-weight: bold;
            margin-top: 20px;
            font-size: 18px;
        }
        .error-message {
            color: red;
            font-size: 14px;
            margin-top: 5px;
        }
        .disabled-option {
            color: #999;
            pointer-events: none;
        }
    </style>
</head>
<body class="{% if request.session.theme %}{{ request.session.theme }}{% else %}light-mode{% endif %}">
    <header class="header">
        <div class="logo-container">
            <img src="https://i.postimg.cc/FzSYsKp6/logo-1.jpg" alt="Trafico Logo" class="logo">
        </div>
        <button class="hamburger" aria-label="Toggle Menu">â˜°</button>
        <div class="nav-links">
            <a href="{% url 'products:product_list' %}" class="nav-link" data-en="Products" data-ar="{% trans 'Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª' %}">{% trans "Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª" %}</a>
            <a href="{% url 'dashboard:dashboard' %}" class="nav-link" data-en="Dashboard" data-ar="{% trans 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…' %}">{% trans "Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…" %}</a>
            <a href="{% url 'dashboard:top_performers' %}" class="nav-link" data-en="Top 10 Marketers & Designers" data-ar="{% trans 'Ø§ÙØ¶Ù„ Ø§Ù„Ù…Ø³ÙˆÙ‚ÙŠÙ† ÙˆØ§Ù„Ù…ØµÙ…Ù…ÙŠÙ†' %}">{% trans "Ø§ÙØ¶Ù„ Ø§Ù„Ù…Ø³ÙˆÙ‚ÙŠÙ† ÙˆØ§Ù„Ù…ØµÙ…Ù…ÙŠÙ†" %}</a>
            <a href="{% url 'dashboard:about_us' %}" class="nav-link" data-en="About" data-ar="{% trans 'Ø¹Ù†Ø§' %}">{% trans "Ø¹Ù†Ø§" %}</a>
            <a href="{% url 'dashboard:contact_us' %}" class="nav-link" data-en="Contact Us" data-ar="{% trans 'ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§' %}">{% trans "ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§" %}</a>
            <a href="{% url 'products:cart' %}" class="nav-link icon" data-en="Cart" data-ar="{% trans 'Ø¹Ø±Ø¨Ø© Ø§Ù„ØªØ³ÙˆÙ‚' %}">ğŸ›’</a>
            {% if user.is_authenticated %}
                <a href="{% url 'users:logout' %}" class="nav-link" data-en="Logout" data-ar="{% trans 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬' %}">{% trans "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬" %}</a>
            {% else %}
                <a href="{% url 'users:login' %}" class="nav-link" data-en="Login" data-ar="{% trans 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„' %}">{% trans "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„" %}</a>
            {% endif %}
            <button id="mode-toggle" class="btn-mode" title="{% trans 'ØªØ¨Ø¯ÙŠÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¸Ù„Ù…' %}" data-title-en="Toggle Dark Mode" data-title-ar="{% trans 'ØªØ¨Ø¯ÙŠÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¸Ù„Ù…' %}">
                <span class="mode-icon">{% if request.session.theme == 'dark-mode' %}â˜€ï¸{% else %}ğŸŒ™{% endif %}</span>
            </button>
            <button id="lang-toggle" class="btn-mode" title="{% trans 'ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ©' %}" data-title-en="Toggle Language" data-title-ar="{% trans 'ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ©' %}">
                <span class="lang-icon">{% get_current_language as LANGUAGE_CODE %}{% if LANGUAGE_CODE == 'ar' %}ğŸ‡¸ğŸ‡¦{% else %}ğŸ‡¬ğŸ‡§{% endif %}</span>
            </button>
        </div>
    </header>
    <main class="container">
        <h2 data-en="Create Order" data-ar="{% trans 'Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨' %}">{% trans "Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨" %}</h2>
        <p>{% trans "Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" %}: {{ user.is_authenticated|yesno:_("Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„,ØºÙŠØ± Ù…Ø³Ø¬Ù„") }}</p>
        <form method="post" action="{% url 'products:create_order' %}">
            {% csrf_token %}
            {% if cart_items %}
                <div class="cart-summary">
                    <h3>{% trans "Ù…Ù„Ø®Øµ Ø§Ù„Ø¹Ø±Ø¨Ø©" %}</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>{% trans "Ø§Ù„Ù…Ù†ØªØ¬" %}</th>
                                <th>{% trans "Ø§Ù„Ù„ÙˆÙ†" %}</th>
                                <th>{% trans "Ø§Ù„Ù…Ù‚Ø§Ø³" %}</th>
                                <th>{% trans "Ø§Ù„ÙƒÙ…ÙŠØ©" %}</th>
                                <th>{% trans "Ø§Ù„Ø³Ø¹Ø±" %}</th>
                                <th>{% trans "Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„Ù…Ø³ÙˆÙ‚" %}</th>
                                <th>{% trans "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ" %}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in cart_items %}
                                <tr>
                                    <td>{{ item.product.name }}</td>
                                    <td>
                                        <select name="color_{{ item.id }}" class="form-control color-select" data-item-id="{{ item.id }}" required>
                                            <option value="" disabled {% if not item.color %}selected{% endif %}>{% trans "Ø§Ø®ØªØ± Ø§Ù„Ù„ÙˆÙ†" %}</option>
                                            {% for color in item.product.colors.all %}
                                                {% if color.stock > 0 %}
                                                    <option value="{{ color.color }}" {% if item.color == color.color %}selected{% endif %} data-stock="{{ color.stock }}">
                                                        {{ color.color }} ({{ color.stock }} {% trans "Ù…ØªÙˆÙØ±" %})
                                                    </option>
                                                {% else %}
                                                    <option value="{{ color.color }}" disabled class="disabled-option">
                                                        {{ color.color }} (0 {% trans "ØºÙŠØ± Ù…ØªÙˆÙØ±" %})
                                                    </option>
                                                {% endif %}
                                            {% endfor %}
                                        </select>
                                        <div class="error-message" id="color-error-{{ item.id }}"></div>
                                    </td>
                                    <td>
                                        <select name="size_{{ item.id }}" class="form-control size-select" data-item-id="{{ item.id }}" required>
                                            <option value="" disabled {% if not item.size %}selected{% endif %}>{% trans "Ø§Ø®ØªØ± Ø§Ù„Ù…Ù‚Ø§Ø³" %}</option>
                                            {% for size in item.product.sizes.all %}
                                                {% if size.stock > 0 %}
                                                    <option value="{{ size.size }}" {% if item.size == size.size %}selected{% endif %} data-stock="{{ size.stock }}">
                                                        {{ size.size }} ({{ size.stock }} {% trans "Ù…ØªÙˆÙØ±" %})
                                                    </option>
                                                {% else %}
                                                    <option value="{{ size.size }}" disabled class="disabled-option">
                                                        {{ size.size }} (0 {% trans "ØºÙŠØ± Ù…ØªÙˆÙØ±" %})
                                                    </option>
                                                {% endif %}
                                            {% endfor %}
                                        </select>
                                        <div class="error-message" id="size-error-{{ item.id }}"></div>
                                    </td>
                                    <td>
                                        <input type="number" name="quantity_{{ item.id }}" class="form-control quantity-input" value="{{ item.quantity }}" min="1" max="{{ item.product.stock }}" data-item-id="{{ item.id }}" required>
                                        <div class="error-message" id="quantity-error-{{ item.id }}"></div>
                                    </td>
                                    <td>
                                        {% if item.product.design_ownership == 'designer' and item.product.design and item.product.design.status == 'approved' %}
                                            <span class="item-price" data-base-price="{{ item.product.base_price|floatformat:2 }}" data-designer-commission="{{ item.product.design.commission_per_sale|floatformat:2 }}">{{ item.product.base_price|add:item.product.design.commission_per_sale|floatformat:2 }}</span> {% trans "Ø¬Ù†ÙŠÙ‡" %}
                                        {% else %}
                                            <span class="item-price" data-base-price="{{ item.product.base_price|floatformat:2 }}" data-designer-commission="0.00">{{ item.product.base_price|floatformat:2 }}</span> {% trans "Ø¬Ù†ÙŠÙ‡" %}
                                        {% endif %}
                                    </td>
                                    <td>
                                        <span class="item-commission" data-commission="{{ item.marketer_commission|floatformat:2 }}">{{ item.marketer_commission|floatformat:2 }}</span> {% trans "Ø¬Ù†ÙŠÙ‡" %}
                                    </td>
                                    <td>
                                        <span class="item-total">
                                            {% if item.product.design_ownership == 'designer' and item.product.design and item.product.design.status == 'approved' %}
                                                {{ item.product.base_price|add:item.product.design.commission_per_sale|add:item.marketer_commission|floatformat:2 }}
                                            {% else %}
                                                {{ item.product.base_price|add:item.marketer_commission|floatformat:2 }}
                                            {% endif %}
                                        </span> {% trans "Ø¬Ù†ÙŠÙ‡" %}
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    <div class="total-price">
                        <p data-en="Subtotal: {{ total_cart_price|floatformat:2 }} EGP" data-ar="{% trans 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ' %}: {{ total_cart_price|floatformat:2 }} {% trans 'Ø¬Ù†ÙŠÙ‡' %}">
                            {% trans "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ" %}: <span id="subtotal">{{ total_cart_price|floatformat:2 }}</span> {% trans "Ø¬Ù†ÙŠÙ‡" %}
                        </p>
                        <p data-en="Shipping Cost: " data-ar="{% trans 'ØªÙƒÙ„ÙØ© Ø§Ù„Ø´Ø­Ù†' %}: ">
                            {% trans "ØªÙƒÙ„ÙØ© Ø§Ù„Ø´Ø­Ù†" %}: <span id="shipping-cost">{{ governorates.0.shipping_cost|default:'0.00' }}</span> {% trans "Ø¬Ù†ÙŠÙ‡" %}
                        </p>
                        <p data-en="Total Price: " data-ar="{% trans 'Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ' %}: ">
                            {% trans "Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ" %}: <span id="total-price">{{ total_cart_price|add:governorates.0.shipping_cost|floatformat:2 }}</span> {% trans "Ø¬Ù†ÙŠÙ‡" %}
                        </p>
                    </div>
                </div>
            {% else %}
                <p>{% trans "Ø§Ù„Ø¹Ø±Ø¨Ø© ÙØ§Ø±ØºØ©" %}</p>
            {% endif %}
            <div class="form-group">
                <label for="customer_name" data-en="Customer Name" data-ar="{% trans 'Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„' %}">{% trans "Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„" %}</label>
                <input type="text" id="customer_name" name="customer_name" required class="form-control">
            </div>
            <div class="form-group">
                <label for="phone_number" data-en="Phone Number" data-ar="{% trans 'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ' %}">{% trans "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" %}</label>
                <input type="text" id="phone_number" name="phone_number" required class="form-control">
            </div>
            <div class="form-group">
                <label for="secondary_phone_number" data-en="Secondary Phone Number" data-ar="{% trans 'Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø«Ø§Ù†Ù' %}">{% trans "Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø«Ø§Ù†Ù" %}</label>
                <input type="text" id="secondary_phone_number" name="secondary_phone_number" class="form-control">
            </div>
            <div class="form-group">
                <label for="governorate" data-en="Governorate" data-ar="{% trans 'Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©' %}">{% trans "Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©" %}</label>
                <select id="governorate" name="governorate" required class="form-control">
                    {% for governorate in governorates %}
                        <option value="{{ governorate.id }}" data-shipping-cost="{{ governorate.shipping_cost }}">{{ governorate.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="shipping_cost" data-en="Shipping Cost" data-ar="{% trans 'ØªÙƒÙ„ÙØ© Ø§Ù„Ø´Ø­Ù†' %}">{% trans "ØªÙƒÙ„ÙØ© Ø§Ù„Ø´Ø­Ù†" %}</label>
                <input type="text" id="shipping_cost" name="shipping_cost" readonly class="form-control" value="{{ governorates.0.shipping_cost|default:'0.00' }}">
            </div>
            <div class="form-group">
                <label for="address" data-en="Address" data-ar="{% trans 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†' %}">{% trans "Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" %}</label>
                <textarea id="address" name="address" required class="form-control"></textarea>
            </div>
            <div class="form-group">
                <label for="notes" data-en="Notes" data-ar="{% trans 'Ù…Ù„Ø§Ø­Ø¸Ø§Øª' %}">{% trans "Ù…Ù„Ø§Ø­Ø¸Ø§Øª" %}</label>
                <textarea id="notes" name="notes" class="form-control"></textarea>
            </div>
            {% if is_marketer %}
                <div class="form-group">
                    <label for="marketer_commission" data-en="Marketer Commission" data-ar="{% trans 'Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„Ù…Ø³ÙˆÙ‚' %}">{% trans "Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„Ù…Ø³ÙˆÙ‚" %}</label>
                    <input type="number" id="marketer_commission" name="marketer_commission" step="0.01" min="0" class="form-control">
                </div>
            {% endif %}
            <button type="submit" class="btn-primary" data-en="Submit Order" data-ar="{% trans 'Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨' %}">{% trans "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨" %}</button>
        </form>
        {% if messages %}
            <div class="form-messages">
                {% for message in messages %}
                    <div class="form-error">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
    </main>
    <footer class="footer">
        <p>{% trans "ØªØ±Ø§ÙÙŠÙƒÙˆ Â© 2025" %}</p>
    </footer>
    <script src="{% static 'js/product_list.js' %}?v={% now 'U' %}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const governorateSelect = document.getElementById('governorate');
            const shippingCostInput = document.getElementById('shipping_cost');
            const totalPriceElement = document.getElementById('total-price');
            const shippingCostElement = document.getElementById('shipping-cost');
            const subtotalElement = document.getElementById('subtotal');

            const cartItems = [
                {% for item in cart_items %}
                    {
                        id: {{ item.id }},
                        price: {{ item.product.base_price|floatformat:2 }},
                        quantity: {{ item.quantity }},
                        commission: {{ item.marketer_commission|floatformat:2 }},
                        designer_commission: {% if item.product.design_ownership == 'designer' and item.product.design and item.product.design.status == 'approved' %}{{ item.product.design.commission_per_sale|floatformat:2 }}{% else %}0.00{% endif %},
                        max_stock: {{ item.product.stock }},
                        colors: {
                            {% for color in item.product.colors.all %}
                                "{{ color.color }}": {{ color.stock }},
                            {% endfor %}
                        },
                        sizes: {
                            {% for size in item.product.sizes.all %}
                                "{{ size.size }}": {{ size.stock }},
                            {% endfor %}
                        }
                    },
                {% endfor %}
            ];

            function calculateTotalPrice() {
                const shippingCost = parseFloat(shippingCostInput.value) || 0;
                const itemsTotal = cartItems.reduce((sum, item) => {
                    const itemPrice = parseFloat(item.price) + parseFloat(item.commission) + parseFloat(item.designer_commission);
                    return sum + (itemPrice * item.quantity);
                }, 0);
                const totalPrice = itemsTotal + shippingCost;
                subtotalElement.textContent = itemsTotal.toFixed(2);
                shippingCostElement.textContent = shippingCost.toFixed(2);
                totalPriceElement.textContent = totalPrice.toFixed(2);
            }

            function validateItem(itemId) {
                const colorSelect = document.querySelector(`select[name="color_${itemId}"]`);
                const sizeSelect = document.querySelector(`select[name="size_${itemId}"]`);
                const quantityInput = document.querySelector(`input[name="quantity_${itemId}"]`);
                const colorError = document.getElementById(`color-error-${itemId}`);
                const sizeError = document.getElementById(`size-error-${itemId}`);
                const quantityError = document.getElementById(`quantity-error-${itemId}`);
                const item = cartItems.find(i => i.id === parseInt(itemId));

                let isValid = true;

                // Clear previous errors
                colorError.textContent = '';
                sizeError.textContent = '';
                quantityError.textContent = '';

                // Validate color
                if (!colorSelect.value) {
                    colorError.textContent = `{% trans "ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù„ÙˆÙ†" %}`;
                    isValid = false;
                } else {
                    const colorStock = item.colors[colorSelect.value] || 0;
                    if (colorStock < parseInt(quantityInput.value)) {
                        colorError.textContent = `{% trans "Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ØºÙŠØ± Ù…ØªÙˆÙØ±Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù„ÙˆÙ†" %}`;
                        isValid = false;
                    }
                }

                // Validate size
                if (!sizeSelect.value) {
                    sizeError.textContent = `{% trans "ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù‚Ø§Ø³" %}`;
                    isValid = false;
                } else {
                    const sizeStock = item.sizes[sizeSelect.value] || 0;
                    if (sizeStock < parseInt(quantityInput.value)) {
                        sizeError.textContent = `{% trans "Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ØºÙŠØ± Ù…ØªÙˆÙØ±Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ù‚Ø§Ø³" %}`;
                        isValid = false;
                    }
                }

                // Validate quantity
                const quantity = parseInt(quantityInput.value);
                if (isNaN(quantity) || quantity <= 0) {
                    quantityError.textContent = `{% trans "Ø§Ù„ÙƒÙ…ÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±" %}`;
                    isValid = false;
                } else if (quantity > item.max_stock) {
                    quantityError.textContent = `{% trans "Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ØºÙŠØ± Ù…ØªÙˆÙØ±Ø© ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„ÙƒÙ„ÙŠ" %}`;
                    isValid = false;
                }

                // Update item quantity in cartItems
                if (isValid) {
                    item.quantity = quantity;
                }

                return isValid;
            }

            // Update total price and validate on color, size, or quantity change
            document.querySelectorAll('.color-select, .size-select, .quantity-input').forEach(element => {
                element.addEventListener('change', () => {
                    const itemId = element.dataset.itemId;
                    if (validateItem(itemId)) {
                        calculateTotalPrice();
                    }
                });
            });

            // Validate all items before form submission
            document.querySelector('form').addEventListener('submit', (e) => {
                let allValid = true;
                cartItems.forEach(item => {
                    if (!validateItem(item.id)) {
                        allValid = false;
                    }
                });
                if (!allValid) {
                    e.preventDefault();
                    alert('{% trans "ÙŠØ±Ø¬Ù‰ ØªØµØ­ÙŠØ­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ Ø§Ù„Ø¹Ø±Ø¨Ø© Ù‚Ø¨Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨" %}');
                }
            });

            if (governorateSelect && shippingCostInput) {
                governorateSelect.addEventListener('change', () => {
                    const selectedOption = governorateSelect.options[governorateSelect.selectedIndex];
                    const shippingCost = selectedOption.getAttribute('data-shipping-cost');
                    shippingCostInput.value = shippingCost;
                    calculateTotalPrice();
                });
                calculateTotalPrice(); // Calculate initial total
            }
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const hamburger = document.querySelector('.hamburger');
            const navLinks = document.querySelector('.nav-links');
            const links = document.querySelectorAll('.nav-link');
            
            hamburger.addEventListener('click', () => {
                navLinks.classList.toggle('active');
                hamburger.textContent = navLinks.classList.contains('active') ? 'âœ•' : 'â˜°';
            });
            
            links.forEach(link => {
                link.addEventListener('click', () => {
                    navLinks.classList.remove('active');
                    hamburger.textContent = 'â˜°';
                });
            });
            
            document.addEventListener('click', (e) => {
                if (!navLinks.contains(e.target) && !hamburger.contains(e.target)) {
                    navLinks.classList.remove('active');
                    hamburger.textContent = 'â˜°';
                }
            });
        });
    </script>
</body>
</html>